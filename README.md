<img align="right" src="assets/icon.svg" width="150" height="150" >

# Bitrise step - Mobile app quality check & monitor

Check native mobile app quality and be warned when they are any changes

This step will get/download your mobile's APK and/or IPA generated by Bitrise and decompile them to look directly inside.

We are looking into the APK/IPA to be sure to have the **REAL** information because during the development of a mobile application, many libraries can be used and these can add some permissions or useless heavy resources without the consent of the developer. Like that, we can follow up them and be aware when we have any unwanted changes

<br/>

## Usage

Add this step using standard Workflow Editor and provide required input environment variables.

<br/>

You can launch this step:
- directly in the step where you generate your APK/IPA, in that case, you have to launch it necessarily after these build steps
- **OR** in another Bitrise build than where you generate your APK/IPA, in that case, you have to setup `outside_build_slug` to download your APK/IPA to do quality checks

<br/>

To give to our step the informations about the expected values, you have:
- create a config file (which should be added to your project repository) and set `config_file_path`  to find them. You can find a config example file [here](#config-file-example)
- **OR** set these keys with expected values directly on Bitrise side
  - android_apk_size
  - android_permission_count
  - ios_ipa_size
  - ios_permission_count
  - alert_threshold

<br/>

## Inputs

The asterisks (*) mean mandatory keys

|Key             |Value type                     |Description    |Default value        
|----------------|-------------|--------------|--------------|
|check_android* |yes/no |Setup - Set yes if you want check Android part|yes|
|check_ios* |yes/no |Setup - Set yes if you want check iOS part|yes|
|ios_app_name* | String |Config - if you want check iOS app, have to set its name, can be found on xcode -> General -> Display Name||
|outside_build_slug |String |Setup - Set the build slug if you exported as an artifact your APK/IPA in another Bitrise build, if you launch this step in the Bitrise build where you generate your APK/IPA, you don't need to setup this key but you have to launch this step after the steps which generate the APK/IPA ||
|config_file_path |String |Config file path - You can create a config file (see bellow example) where you can set different needed data to follow up values via your git client - eg. `folder/config.sh` ||
|android_apk_path | String |Config - File path to APK file to get info from|$BITRISE_APK_PATH|
|android_apk_size | String |Config - APK's expected size (value in MB) - *not need to set if already set into your config file*||
|android_permission_count | String |Config - APK's expected permission count - *not need to set if already set into your config file*||
|ios_ipa_path | String |Config - File path to IPA file to get info from|$BITRISE_IPA_PATH|
|ios_ipa_size | String |Config - IPA's expected size (value in MB) - *not need to set if already set into your config file*||
|ios_permission_count | String |Config - iIPA's expected permission count - *not need to set if already set into your config file*||
|alert_threshold | String |Config - To generate an error when Android and/or iOS app's size exceeds this threshold - *not need to set if already set into your config file*|5 (MB)|

<br />

## Outputs

|Key             |Value type    |Description
|----------------|-------------|--------------|
|IOS_PERMISSION_COUNT |String |New generated iOS app's permission count|
|NEW_IPA_SIZE |String |New generated iOS app's size|
|ANDROID_PERMISSION_COUNT |String |New generated Android app's permission count|
|NEW_APK_SIZE |String |New generated Android app's size|

<br />

### Config file example

config.sh
```bash
android_permission_count=10
ios_permission_count=5
android_apk_size=35
ios_ipa_size=28
alert_threshold=3
```
